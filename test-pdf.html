<!DOCTYPE html>
<html>
<head>
    <title>PDF Generation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <h1>PDF Generation Test</h1>
    
    <div class="test-section">
        <h2>Test PDF Generation</h2>
        <button onclick="testPdfGeneration()">Test PDF Generation</button>
        <div id="result"></div>
    </div>

    <script>
        // Sample resume data for testing
        const sampleData = {
            template: "modern",
            header: {
                name: "John Doe",
                location: "New York, NY",
                phone: "(555) 123-4567",
                email: "john.doe@email.com",
                linkedin: "https://linkedin.com/in/johndoe",
                github: "https://github.com/johndoe"
            },
            experience: [
                {
                    role: "Software Engineer",
                    organization: "Tech Company",
                    duration: "2020 - Present",
                    bullets: [
                        "Developed web applications using React and Node.js",
                        "Led team of 5 developers on major project",
                        "Improved application performance by 40%"
                    ]
                }
            ],
            education: [
                {
                    degree: "Bachelor of Science in Computer Science",
                    institution: "University Name",
                    duration: "2016 - 2020",
                    gpa: "3.8"
                }
            ],
            skills: ["JavaScript", "React", "Node.js", "Python", "SQL"]
        };

        async function testPdfGeneration() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing PDF generation...</p>';
            
            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sampleData),
                    credentials: 'include',
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'test_resume.pdf';
                    a.textContent = 'Download Test PDF';
                    a.style.display = 'block';
                    a.style.marginTop = '10px';
                    
                    resultDiv.innerHTML = '<div class="success">✓ PDF generated successfully!</div>';
                    resultDiv.appendChild(a);
                    
                    // Clean up
                    setTimeout(() => window.URL.revokeObjectURL(url), 1000);
                } else {
                    const errorData = await response.json();
                    resultDiv.innerHTML = `<div class="error">✗ PDF generation failed: ${errorData.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>